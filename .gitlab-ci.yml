variables:
  GIT_STRATEGY: clone

stages:
  - build

build-clang:
  stage: build
  tags:
    - clang
  script:
    - cd ..
    - rm -rf build_clang
    - mkdir build_clang
    - cd build_clang
    - source ../genten/scripts/sems_clang/setup_env.sh
    - ../genten/scripts/sems_clang/do_configure.sh
    - make -j8
    - ctest
  rules:
    - if $CI_SERVER_HOST == cee-gitlab.sandia.gov

build-gcc:
  stage: build
  tags:
    - gcc
  script:
    - cd ..
    - rm -rf build_gcc
    - mkdir build_gcc
    - cd build_gcc
    - source ../genten/scripts/sems_gcc/setup_env.sh
    - ../genten/scripts/sems_gcc/do_configure.sh
    - make -j8
    - ctest
  rules:
    - if $CI_SERVER_HOST == cee-gitlab.sandia.gov

build-intel:
  stage: build
  tags:
    - intel
  script:
    - cd ..
    - rm -rf build_intel
    - mkdir build_intel
    - cd build_intel
    - source ../genten/scripts/sems_intel/setup_env.sh
    - ../genten/scripts/sems_intel/do_configure.sh
    - make -j8
    - ctest
  rules:
    - if $CI_SERVER_HOST == cee-gitlab.sandia.gov

build-cuda-kepler:
  stage: build
  tags:
    - cuda_kepler
  script:
    - cd ..
    - rm -rf build_cuda_kepler
    - mkdir build_cuda_kepler
    - cd build_cuda_kepler
    - source ../genten/scripts/elbert_cuda_kepler/setup_env.sh
    - ../genten/scripts/elbert_cuda_kepler/do_configure.sh
    - make -j32
    - ctest
  rules:
    - if $CI_SERVER_HOST == cee-gitlab.sandia.gov

build-gitlab-gcc:
  stage: build
  image: gcc
  before_script:
    - apt-get update --yes
    - apt-get install --yes cmake
    - apt-get install --yes libblas-dev liblapack-dev
  script:
    - cd ..
    - rm -rf build_gitlab_gcc
    - mkdir build_gitlab_gcc
    - cd build_gitlab_gcc
    - ../genten/scripts/gitlab_gcc/do_configure.sh
    - make -j4
    - ctest
  rules:
    - if $CI_SERVER_HOST == gitlab.com
